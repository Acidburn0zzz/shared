<!DOCTYPE html>
<html xmlns:og="http://opengraphprotocol.org/schema/"
      xmlns:fb="http://developers.facebook.com/schema/">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <title>{{page.title}}</title>
    {% if page.meta_title %}
    <meta name="title" content="{{page.title}}" />
    {% endif %}
    {% if page.meta_description %}
    <meta name="description" content="{{page.meta_description}}" />
    {% endif %}
    {% if page.meta_keywords %}
    <meta name="keywords" content="{{page.meta_keywords}}" />
    {% endif %}
    {% if page.meta_image %}
    <link rel="image_src" href="{{page.meta_image}}" />
    {% endif %}
    <meta name="google-site-verification" content="N_xzdr6ymSUQFhAEvQg7f-sp1JAeJCdW2JuaRg-da0w" />

    <meta property="fb:admins" content="antonin.hildebrand" />
    {% if page.ogmeta %}
        {% if page.ogmeta.email %}
            <meta property="og:email" content="{{page.ogmeta.email}}" />
        {% endif %}
        {% if page.ogmeta.description %}
            <meta property="og:description" content="{{page.ogmeta.description}}" />
        {% endif %}
        {% if page.ogmeta.site_name %}
            <meta property="og:site_name" content="{{page.ogmeta.site_name}}" />
        {% endif %}
        {% if page.ogmeta.type %}
            <meta property="og:type" content="{{page.ogmeta.type}}" />
        {% endif %}
        {% if page.ogmeta.title %}
            <meta property="og:title" content="{{page.ogmeta.title}}" />
        {% endif %}
        {% if page.ogmeta.url %}
            <meta property="og:url" content="{{page.ogmeta.url}}" />
        {% endif %}
        {% if page.ogmeta.image %}
            <meta property="og:image" content="{{page.ogmeta.image}}" />
        {% endif %}
    {% endif %}

    <link href="http://www.google.com/profiles/antonin.hildebrand" rel="me" type="text/html" />
    <link href="http://feeds.feedburner.com/binaryage-blog" type="application/atom+xml" rel="alternate" title="The ideas from BinaryAge" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/shared/css/site.css" type="text/css">
    {% if page.styles %}
        {% for s in page.styles %}
            <link rel="stylesheet" href="{{s}}.css" type="text/css">
        {% endfor %}
    {% endif %}
    <script type="text/javascript" charset="utf-8">
    /*
    CSS Browser Selector v0.3.5 (Feb 05, 2010)
    Rafael Lima (http://rafael.adm.br)
    http://rafael.adm.br/css_browser_selector
    License: http://creativecommons.org/licenses/by/2.5/
    Contributors: http://rafael.adm.br/css_browser_selector#contributors
    */
    function css_browser_selector(u){var ua = u.toLowerCase(),is=function(t){return ua.indexOf(t)>-1;},g='gecko',w='webkit',s='safari',o='opera',h=document.documentElement,b=[(!(/opera|webtv/i.test(ua))&&/msie\s(\d)/.test(ua))?('ie ie'+RegExp.$1):is('firefox/2')?g+' ff2':is('firefox/3.5')?g+' ff3 ff3_5':is('firefox/3')?g+' ff3':is('gecko/')?g:is('opera')?o+(/version\/(\d+)/.test(ua)?' '+o+RegExp.$1:(/opera(\s|\/)(\d+)/.test(ua)?' '+o+RegExp.$2:'')):is('konqueror')?'konqueror':is('chrome')?w+' chrome':is('iron')?w+' iron':is('applewebkit/')?w+' '+s+(/version\/(\d+)/.test(ua)?' '+s+RegExp.$1:''):is('mozilla/')?g:'',is('j2me')?'mobile':is('iphone')?'iphone':is('ipod')?'ipod':is('mac')?'mac':is('darwin')?'mac':is('webtv')?'webtv':is('win')?'win':is('freebsd')?'freebsd':(is('x11')||is('linux'))?'linux':'','js']; c = b.join(' '); h.className += ' '+c; return c;}; css_browser_selector(navigator.userAgent);        
    </script>
    <script src="/shared/js/code.js"></script>
    {% if page.scripts %}
        {% for s in page.scripts %}
            <script src="{{s}}"></script>
        {% endfor %}
    {% endif %}
    
    {% if site.url contains ".com" %}
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-8404259-1']);
      _gaq.push(['_setDomainName', '.binaryage.com']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    {% endif %}
    
  </head>
  <body>
    <div id="header">
        <div class="container header-bar">
            <div class="span-7">
                <a href="http://binaryage.com" title="Binary Age - tools for developers"><div class="header-logo"></div></a>
                <div class="twitter-praise-wrapper">
                    <div class="praise-button">twitter praise</div>
                </div>
                <div class="twitter-icon-wrapper">
                    <a href="http://www.twitter.com/binaryage"><img src="http://twitter-badges.s3.amazonaws.com/follow_bird-b.png" alt="Follow binaryage on Twitter"/></a>
                </div>
                <div class="twitterbox">
                    <div id="tweets-scrollable">
                        <ol id="tweets" class="statuses">
                        </ol>
                    </div>
                </div>
                <div class="lovebox" style="display:none">
                </div>
            </div>
            <div class="span-17 last">
                <ul class="header-menu {{page.menu}} segment">
                    <li class="segment-1 menu-item-store"><a href=""><span>store</span></a></li>
                    <li class="segment-0 menu-item-products"><a href="http://binaryage.com"><span>products</span></a></li>
                    <li class="segment-0 menu-item-blog"><a href="http://blog.binaryage.com"><span>blog</span></a></li>
                    <li class="segment-2 menu-item-about"><a href="http://binaryage.com/about"><span>about</span></a></li>
                </ul>
            </div>
        </div>
    </div>
    <div id="main">
      {{content}}
      <div class="clear"></div>
    </div>
    <div id="footer">
      <div class="container">
          <div class="footer-separator"></div>
          <div class="footerbox">
             {% if page.fblikefooter %}
             <div class="facebook-like-button-wrapper">
                 <fb:like href="http://www.binaryage.com" layout="standard" show_faces="false" width="600" action="like" font="arial" colorscheme="light"></fb:like>
             </div>
             <div class="footer-links force-right">
               <a href="http://binaryage.com">products</a> | 
               <!-- <a href="http://store.binaryage.com">store</a> |  -->
               <a href="http://blog.binaryage.com">blog</a> | 
               <!-- <a href="http://binaryage.com/mediakit">mediakit</a> |  -->
               <a href="http://getsatisfaction.com/binaryage">support</a>
              {% if page.repo %}
                   | <a href="{{page.repo}}">source code</a>
              {% endif %}
             </div>
             {% else %}
             <div class="logos">
                <div class="raist-cz">
                  <a href="http://raist.cz"><div class="footer-logo raist-logo" title="Raist.cz - webdesign"></div></a>
                </div>
                {% if page.repo %}
                <div class="github-icon">
                  <a href="{{page.repo}}"><div class="footer-logo github-logo" title="GitHub - social code hosting"></div></a>
                </div>
                {% else %}
                <div class="github-icon">
                  <a href="http://github.com/darwin"><div class="footer-logo github-logo" title="GitHub - social code hosting"></div></a>
                </div>
                {% endif %}
                <div class="binary-age">
                   <a href="http://www.binaryage.com"><div class="footer-logo binaryage-logo" title="BinaryAge - tools for power users"></div></a>
                </div>
             </div>
             <div class="copyright">
               <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/us/"><img title="Web site license" alt="Creative Commons License" style="border-width:0" src="/shared/img/byccnd.png" /></a>
             </div>
             <div class="footer-links">
               <a href="http://binaryage.com">products</a> | 
               <!-- <a href="http://store.binaryage.com">store</a> |  -->
               <a href="http://blog.binaryage.com">blog</a> | 
               <!-- <a href="http://binaryage.com/mediakit">mediakit</a> |  -->
               <a href="http://getsatisfaction.com/binaryage">support</a>
              {% if page.repo %}
                   | <a href="{{page.repo}}">source code</a>
              {% endif %}
             </div>
             {% endif %}
          </div>
       </div>
    </div>
    
{% if page.repo %}
    <a href="{{page.repo}}"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub" /></a>    
{% endif %}

{% if site.url contains ".org" %}
    <script type="text/javascript" charset="utf-8">
        if ((document.location+"").match(/showgrid/)) {
            $('.container').addClass('showgrid');
        }
    </script>
{% endif %}
    
{% if page.fbsdk %}
<div id="fb-root"></div>
<script>
  window.fbAsyncInit = function() {
    FB.init({appId: '332451499524', status: true, cookie: true, xfbml: true});
  };
  (function() {
    var e = document.createElement('script'); e.async = true;
    e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
    document.getElementById('fb-root').appendChild(e);
  }());
</script>
{% endif %}

{% if page.satisfaction %}
    <div id="getsatifucktion"></div>
    <div id="getsatifucktion2"></div>
    <script type="text/javascript" charset="utf-8">
      $("#getsatifucktion").html(writeCapture.sanitize('<scr'+'ipt type="text/javascript" src="http://s3.amazonaws.com/getsatisfaction.com/javascripts/feedback-v2.js"></scr'+'ipt>', {
          done: function() {
              if (typeof window.GSFN == "object") {
                  var GSFNFeedbackWidget = new GSFN.feedback_widget({
                      container: "getsatifucktion2",
                      display: "overlay",
                      company: "binaryage",
                      placement: "left",
                      color: "#656565",
                      style: "idea"
                  });
              }
          }
      }));
    </script>
{% endif %}

{% if page.disqus %}
    <div id="disqus-wrapper"></div>
    <script type="text/javascript">
    (function() {
        var links = document.getElementsByTagName('a');
        var query = '?';
        for(var i = 0; i < links.length; i++) {
            if(links[i].href.indexOf('#disqus_thread') >= 0) {
                query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
            }
        }
        $('#disqus-wrapper').html('<scr'+'ipt charset="utf-8" type="text/javascript" src="http://disqus.com/forums/binaryage/get_num_replies.js' + query + '"></scr'+'ipt>');
    })();
    </script>
{% endif %}

    <script>
    $.fn.autolink = function () {
        return $(this).each(function() {
            var el = $(this);
            var re = /((http|https|ftp):\/\/[\w?=&.\/-;#~%-]+(?![\w\s?&.\/;#~%"=-]*>))/g;
            el.html(el.html().replace(re, '<a href="$1">$1</a>'));
        });
    };

    $.fn.autohash = function () {
        return $(this).each(function() {
            var el = $(this);
            var re = /#(\w+)/g;
            el.html(el.html().replace(re, '<a href="http://twitter.com/search?q=%23$1">#$1</a>'));
        });
    };

    // All credit goes to Rick Olson.
    (function($) {
      $.fn.relatizeDate = function() {
        return $(this).each(function() {
          $(this).text( $.relatizeDate(this) );
        });
      };

      $.relatizeDate = function(element) {
            var date = new Date( $(element).text() );

            if (isNaN(date.getTime()))
                date = new Date( $(element).attr("title") );

            if (isNaN(date.getTime()))
                date = new Date(parseInt( $(element).attr("title") ));

            if (isNaN(date.getTime()))
                return $(element).text();
            else 
                return $.relatizeDate.timeAgoInWords(date);  
        };

      // shortcut
      $r = $.relatizeDate;

      $.extend($.relatizeDate, {
        shortDays: [ 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat' ],
        days: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
        shortMonths: [ 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec' ],
        months: [ 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December' ],

        /**
         * Given a formatted string, replace the necessary items and return.
         * Example: Time.now().strftime("%B %d, %Y") => February 11, 2008
         * @param {String} format The formatted string used to format the results
         */
        strftime: function(date, format) {
          var day = date.getDay(), month = date.getMonth();
          var hours = date.getHours(), minutes = date.getMinutes();

          var pad = function(num) { 
            var string = num.toString(10);
            return new Array((2 - string.length) + 1).join('0') + string;
          };

          return format.replace(/\%([aAbBcdHImMpSwyY])/g, function(part) {
            switch(part[1]) {
              case 'a': return $r.shortDays[day]; break;
              case 'A': return $r.days[day]; break;
              case 'b': return $r.shortMonths[month]; break;
              case 'B': return $r.months[month]; break;
              case 'c': return date.toString(); break;
              case 'd': return pad(date.getDate()); break;
              case 'H': return pad(hours); break;
              case 'I': return pad((hours + 12) % 12); break;
              case 'm': return pad(month + 1); break;
              case 'M': return pad(minutes); break;
              case 'p': return hours > 12 ? 'PM' : 'AM'; break;
              case 'S': return pad(date.getSeconds()); break;
              case 'w': return day; break;
              case 'y': return pad(date.getFullYear() % 100); break;
              case 'Y': return date.getFullYear().toString(); break;
            }
          });
        },

        timeAgoInWords: function(targetDate, includeTime) {
          return $r.distanceOfTimeInWords(targetDate, new Date(), includeTime);
        },

        /**
         * Return the distance of time in words between two Date's
         * Example: '5 days ago', 'about an hour ago'
         * @param {Date} fromTime The start date to use in the calculation
         * @param {Date} toTime The end date to use in the calculation
         * @param {Boolean} Include the time in the output
         */
        distanceOfTimeInWords: function(fromTime, toTime, includeTime) {
          var delta = parseInt((toTime.getTime() - fromTime.getTime()) / 1000, 10);
          if (delta < 60) {
              return 'less than a minute ago';
          } else if (delta < 120) {
              return 'about a minute ago';
          } else if (delta < (45*60)) {
              return (parseInt(delta / 60, 10)).toString() + ' minutes ago';
          } else if (delta < (120*60)) {
              return 'about an hour ago';
          } else if (delta < (24*60*60)) {
              return 'about ' + (parseInt(delta / 3600, 10)).toString() + ' hours ago';
          } else if (delta < (48*60*60)) {
              return '1 day ago';
          } else {
            var days = (parseInt(delta / 86400, 10)).toString();
            if (days > 5) {
              var fmt  = '%B %d, %Y';
              if (includeTime) fmt += ' %I:%M %p';
              return $r.strftime(fromTime, fmt);
            } else {
              return days + " days ago";
            }
          }
        }
      });
    })(jQuery);

    function prepareTweetLoader(msg) {
        return [
            '<li class="hentry status" id="tweet-loader">',
            '<span class="thumb vcard author"><img width="31" height="31" src="/shared/img/twitter-loader.gif"></span>',
            '<span class="status-body"><span class="tweet-msg">'+msg+'</span><a class="more-praise" target="_blank" href="http://twitter.com/binaryage/favorites">show all recent</a></span>',
            '</li>'
        ].join('');
    }

    $.fn.tweet = function(options) {

        var generator = function(root, params) {
            var itemTemplate = '\
                <li id="status_--id--" class="hentry status">\
                    <span class="thumb vcard author">\
                        <a class="tweet-url profile-pic url" href="http://twitter.com/--userscreenname--">\
                            <img width="48" height="48" src="--avatar--" class="photo fn" alt="--username--">\
                        </a>\
                    </span>\
                    <span class="status-body">\
                        <strong><a title="--username--" class="tweet-url screen-name" href="http://twitter.com/--userscreenname--">--userscreenname--</a></strong> \
                        <span class="entry-content">--text--</span><span class="meta entry-meta">\
                            <a rel="bookmark" class="entry-date" href="http://twitter.com/--userscreenname--/status/--id--"><span class="published timestamp">--createdat--</span></a> \
                            <span>from --source--</span>\
                        </span>\
                        <a class="more-praise" target="_blank" href="http://twitter.com/binaryage/favorites">show all recent</a>\
                    </span>\
                </li>';

            $.getJSON('http://twitter.com/favorites.json?page='+params.page+'&id='+encodeURIComponent(params.user)+'&callback=?', function(data) {
                if (!data.length) {
                    $('#tweet-loader .tweet-msg').html('No more tweets!<br/><a href="http://twitter.com">What do you think about apps from BinaryAge?</a>');
                } else {
                    root.children().slice(0, -1).remove();
                    for (var i=0; i<data.length; i++) {
                        var item = data[i];

                        var li = itemTemplate;
                        li = li.replace(/--id--/g, item.id);
                        li = li.replace(/--text--/g, item.text);
                        li = li.replace(/--avatar--/g, item.user.profile_image_url);
                        li = li.replace(/--username--/g, item.user.name);
                        li = li.replace(/--userscreenname--/g, item.user.screen_name);
                        li = li.replace(/--source--/g, item.source);
                        li = li.replace(/--createdat--/g, item.created_at);
                        root.append($(li));
                    }
                    root.find('.published').relatizeDate();
                    root.find('.entry-content').autolink().autohash();
                    $('#tweets').append(prepareTweetLoader('Loading even more tweets ...'));

                    jQuery.fx.off = true;
                    params.scrollable.reload().begin();
                    jQuery.fx.off = false;
                }
            });
        }


        return this.each(function() {
            var root = $(this);

            var defaults = {
                user: 'binaryage',
                count: 5
            };
            var params = $.extend(defaults, options);

            params.scrollable = $("#tweets-scrollable").scrollable({ 
                onSeek: function(instance, index) {
                    if (index == this.getItems().length-1) {
                        params.page++;
                        generator(root, params);
                    }
                },
                api:true,
                vertical:true,
                hoverClass: 'hover',
                keyboard: false,
                size: 1
            });
            params.autoscroll = $("#tweets-scrollable").autoscroll({ autoplay: true, interval: 5000, api:true });
            params.page = 1;
            root.data('sparams', params);
            generator(root, params);
        });
    };

    $('#tweets').append(prepareTweetLoader('Waiting for page to fully load ...'));
    
    $(function() {
        var initialized;
        var header = $('#header');
        $('.praise-button').bind('click', function() {
            $(this).toggleClass('pushed');
            header.toggleClass('expanded-header');
            if (!header.hasClass('expanded-header')) {
                $("#tweets").data('sparams').autoscroll.pause();
            } else {
                if (initialized) {
                    $("#tweets").data('sparams').autoscroll.play();
                } else {
                    setTimeout(function() {
                        $('.lovebox').show('slow');
                    }, 8000);
                }
            }
            if (!initialized) {
                $('#tweet-loader .tweet-msg').html('Asking Twitter for some shouts about BinaryAge ...');
                $("#tweets").tweet({
                    user: "binaryage"
                });
                initialized = true;
            }
        });
    });
    
    </script>
    <script>
    // localhost debug
    $(function() {
        var host = document.location.host;
        if (host.substring(host.length-3)=='org') {
            console.info('replacing all binaryage.com links to binaryage.org ...');
            $('a').each(function() {
                var el = $(this);
                var href = el.attr('href');
                if (href && href.match('binaryage.com')) {
                    href = href.replace('binaryage.com', 'binaryage.org');
                    el.attr('href', href);
                }
            });
        }
    });
    </script>
    
  </body>
</html>